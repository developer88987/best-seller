!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.bestseller=t():e.bestseller=t()}(self,(()=>(()=>{function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,a,c=[],i=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=l.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var n=wp.blocks.registerBlockType,r=wp.blockEditor.InspectorControls,o=wp.components,l=o.PanelBody,a=o.Spinner,c=o.Button,i=o.TextControl,u=wp.element,s=u.useState,d=u.useRef,f=u.useEffect,m=function(t){var n,r=t.options,o=t.selectedValue,l=t.onSelect,a=e(s(!1),2),u=a[0],m=a[1],b=e(s(""),2),p=b[0],v=b[1],g=e(s(r),2),h=g[0],y=g[1],E=d(null);return f((function(){y(r.filter((function(e){return e.label.toLowerCase().includes(p.toLowerCase())})))}),[p,r]),f((function(){var e=function(e){E.current&&!E.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),function(){return document.removeEventListener("mousedown",e)}}),[]),React.createElement("div",{className:"filterable-dropdown",ref:E},React.createElement(c,{onClick:function(){return m(!u)},isSecondary:!0,"aria-expanded":u},o?null===(n=r.find((function(e){return e.value===o})))||void 0===n?void 0:n.label:"Select Collection"),u&&React.createElement("div",{className:"dropdown-menu"},React.createElement(i,{value:p,onChange:v,placeholder:"Type to search..."}),React.createElement("ul",null,h.length?h.map((function(e){return React.createElement("li",{key:e.value,onClick:function(){l(e.value),m(!1)}},e.label)})):React.createElement("li",null,"No options available"))))};return n("best-seller/book-genre",{title:"Book Genre",icon:"book",category:"widgets",attributes:{title:{type:"string",default:"Bestsellers"},genre:{type:"string",default:""},book:{type:"string",default:""}},edit:function(t){var n=t.attributes,o=n.title,c=n.genre,u=n.book,d=t.setAttributes,b=e(s([{label:"Select a Genre",value:""}]),2),p=b[0],v=b[1],g=e(s([{label:"Select a Book",value:""}]),2),h=g[0],y=g[1],E=e(s(!0),2),k=E[0],R=E[1],w=e(s(null),2),S=w[0],x=w[1];return f((function(){fetch("https://api-test.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/categories?api_key=qx4hfd2x6r4re89tbkxga2hy&rows=100").then((function(e){return e.json()})).then((function(e){if(!(e&&e.data&&e.data.categories))throw new Error("Invalid data structure received.");var t=e.data.categories.map((function(e){return{label:e.menuText,value:e.catUri}}));v(t),R(!1)})).catch((function(e){console.error("Error fetching genres:",e),x("Failed to load genres."),R(!1)}))}),[]),f((function(){c&&(y([{label:"Loading books...",value:""}]),fetch("https://api-test.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/works/views/list-display?api_key=qx4hfd2x6r4re89tbkxga2hy&rows=0&sort=weeklySales&dir=desc&catUri=".concat(c)).then((function(e){return e.json()})).then((function(e){if(!(e&&e.data&&e.data.works))throw new Error("Invalid data structure received.");var t=e.data.works.map((function(e){return{label:e.title,value:e.workId}}));y(t),R(!1)})).catch((function(e){console.error("Error fetching books:",e),y([{label:"Failed to load books",value:""}]),R(!1)})))}),[c]),k?React.createElement(a,null):S?React.createElement("p",null,S):React.createElement(React.Fragment,null,React.createElement(r,null,React.createElement(l,{title:"Block Options"},React.createElement(i,{label:"Title",value:o,onChange:function(e){return d({title:e})},placeholder:"Enter title..."}),React.createElement(m,{options:p,selectedValue:c,onSelect:function(e){d({genre:e}),d({book:""})}}),c&&React.createElement(m,{options:h,selectedValue:u,onSelect:function(e){d({book:e})}}))),React.createElement("div",null,React.createElement("h2",null,o)," ",React.createElement("strong",null,"Selected Genre:")," ",c||"No genre selected",React.createElement("br",null),React.createElement("strong",null,"Selected Book:")," ",u||"No book selected"))},save:function(e){var t=e.attributes,n=t.title,r=t.genre,o=t.book;return React.createElement("div",null,React.createElement("h2",null,n)," ",React.createElement("strong",null,"Genre:")," ",r||"No genre selected",React.createElement("br",null),React.createElement("strong",null,"Book:")," ",o||"No book selected")}}),{}})()));